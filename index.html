<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Synchronised Player ğŸ”Š</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>
  <h1>ğŸ”¥ Sync Audio Player</h1>
  <input type="file" id="fileInput" accept="audio/mpeg, audio/wav">
  <br>
  <audio id="audioPlayer" controls></audio>

  <script>
    // === CONFIG FIREBASE ===
    const firebaseConfig = {
        apiKey: "AIzaSyBNtP-si49U1vt7_AaMu7jEezugoW1fRf0",
        authDomain: "syncaudioplay.firebaseapp.com",
        databaseURL: "https://syncaudioplay-default-rtdb.firebaseio.com",
        projectId: "syncaudioplay",
        storageBucket: "syncaudioplay.firebasestorage.app",
        messagingSenderId: "556142851295",
        appId: "1:556142851295:web:38b02aeae776d5e157256a",
        measurementId: "G-ZPG03GBV0E"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const player = document.getElementById("audioPlayer");
    const input = document.getElementById("fileInput");

    let isMaster = false;

    // Quand tu uploades un fichier, tu es le master (chef de la lecture)
    input.addEventListener("change", () => {
      const file = input.files[0];
      const url = URL.createObjectURL(file);
      player.src = url;
      isMaster = true;
    });

    // Le chef envoie les events de play/pause/time
    player.addEventListener("play", () => {
      if (isMaster) db.ref("sync").set({ action: "play", time: player.currentTime });
    });

    player.addEventListener("pause", () => {
      if (isMaster) db.ref("sync").set({ action: "pause", time: player.currentTime });
    });

    player.addEventListener("seeked", () => {
      if (isMaster) db.ref("sync").set({ action: "seek", time: player.currentTime });
    });

    // Les autres Ã©coutent et se synchronisent
    db.ref("sync").on("value", snap => {
      const data = snap.val();
      if (!isMaster && data) {
        player.currentTime = data.time;
        if (data.action === "play") player.play();
        if (data.action === "pause") player.pause();
      }
    });
  </script>
</body>
</html>
